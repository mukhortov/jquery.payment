(function(){var t,e,n,r,a,i,u,s,l,c,o,h,d,g,v,f,p,m,y,L,E,C,T,w,D,S,b=[].slice,k=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};g=function(){var t,e,n;if(n=arguments[0],e=arguments[1],t=3<=arguments.length?b.call(arguments,2):[],e)return g.fn[n].apply(e,t)},g.fn={},r=/(\d{1,4})/g,g.cards=n=[{type:"maestro",patterns:[5018,502,503,506,56,58,639,6220,67],format:r,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",patterns:[600],format:r,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",patterns:[5019],format:r,length:[16],cvcLength:[3],luhn:!0},{type:"visa",patterns:[4],format:r,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:r,length:[16],cvcLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:r,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:r,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:r,length:[16],cvcLength:[3],luhn:!0}],d=function(t,e,n){t.addEventListener(e,function(t){var e;return e=n(t),e||t.preventDefault(),e},!1)},S=function(t){return(t+"").replace(/^\s+|\s+$/g,"")},t=function(t){var e,r,a,i,u,s,l,c;for(t=(t+"").replace(/\D/g,""),r=0,i=n.length;r<i;r++)for(e=n[r],c=e.patterns,a=0,u=c.length;a<u;a++)if(l=c[a],s=l+"",t.substr(0,s.length)===s)return e},e=function(t){var e,r,a;for(r=0,a=n.length;r<a;r++)if(e=n[r],e.type===t)return e},h=function(t){var e,n,r,a,i,u;for(i=!0,u=0,n=(t+"").split("").reverse(),r=0,a=n.length;r<a;r++)e=n[r],e=parseInt(e,10),(i=!i)&&(e*=2),e>9&&(e-=9),u+=e;return u%10===0},o=function(t){var e;return null!=t.selectionStart&&t.selectionStart!==t.selectionEnd||!(null==("undefined"!=typeof document&&null!==document&&null!=(e=document.selection)?e.createRange:void 0)||!document.selection.createRange().text)},w=function(t,e){var n,r,a,i,u,s,l;try{r=e.selectionStart}catch(t){i=t,r=null}if(s=e.value,e.value=t,null!==r&&e===document.activeElement)return r===s.length&&(r=t.length),s!==t&&(l=s.slice(r-1,+r+1||9e9),n=t.slice(r-1,+r+1||9e9),a=t[r],/\d/.test(a)&&l===a+" "&&n===" "+a&&(r+=1)),e.selectionStart=r,e.selectionEnd=r},y=function(t){var e,n,r,a,i,u,s,l;for(null==t&&(t=""),r="０１２３４５６７８９",a="0123456789",l="",e=t.split(""),i=0,s=e.length;i<s;i++)n=e[i],u=r.indexOf(n),u>-1&&(n=a[u]),l+=n;return l},m=function(t){var e;return e=t.currentTarget||t.target,setTimeout(function(){var t;return t=e.value,t=y(t),t=t.replace(/\D/g,""),w(t,e)})},f=function(t){var e;return e=t.currentTarget||t.target,setTimeout(function(){var t;return t=e.value,t=y(t),t=g.formatCardNumber(t),w(t,e)})},u=function(e){var n,r,a,i,u,s,l;if(r=String.fromCharCode(e.which),/^\d+$/.test(r)&&(u=e.currentTarget||e.target,l=u.value,n=t(l+r),a=(l.replace(/\D/g,"")+r).length,s=16,n&&(s=n.length[n.length.length-1]),!(a>=s||null!=u.getAttribute("selectionStart")&&u.getAttribute("selectionStart")!==l.length)))return i=n&&"amex"===n.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,i.test(l)?(e.preventDefault(),setTimeout(function(){return u.value=l+" "+r})):i.test(l+r)?(e.preventDefault(),setTimeout(function(){return u.value=l+r+" "})):void 0},a=function(t){var e,n;if(e=t.currentTarget||t.target,n=e.value,8===t.which&&(null==e.getAttribute("selectionStart")||e.getAttribute("selectionStart")===n.length))return/\d\s$/.test(n)?(t.preventDefault(),setTimeout(function(){return e.value=n.replace(/\d\s$/,"")})):/\s\d?$/.test(n)?(t.preventDefault(),setTimeout(function(){return e.value=n.replace(/\d$/,"")})):void 0},p=function(t){var e;return e=t.currentTarget||t.target,setTimeout(function(){var t;return t=e.value,t=y(t),t=g.formatExpiry(t),w(t,e)})},s=function(t){var e,n,r;if(e=String.fromCharCode(t.which),/^\d+$/.test(e))return n=t.currentTarget||t.target,r=n.value+e,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(t.preventDefault(),setTimeout(function(){return n.value="0"+r+" / "})):/^\d\d$/.test(r)?(t.preventDefault(),setTimeout(function(){var t,e;return t=parseInt(r[0],10),e=parseInt(r[1],10),e>2&&0!==t?n.value="0"+t+" / "+e:n.value=r+" / "})):void 0},l=function(t){var e,n,r;if(e=String.fromCharCode(t.which),/^\d+$/.test(e))return n=t.currentTarget||t.target,r=n.value,/^\d\d$/.test(r)?n.value=r+" / ":void 0},c=function(t){var e,n,r;if(r=String.fromCharCode(t.which),"/"===r||" "===r)return e=t.currentTarget||t.target,n=e.value,/^\d$/.test(n)&&"0"!==n?e.value="0"+n+" / ":void 0},i=function(t){var e,n;if(e=t.currentTarget||t.target,n=e.value,8===t.which&&(null==e.getAttribute("selectionStart")||e.getAttribute("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(t.preventDefault(),setTimeout(function(){return e.value=n.replace(/\d\s\/\s$/,"")})):void 0},v=function(t){var e;return e=t.currentTarget||t.target,setTimeout(function(){var t;return t=e.value,t=y(t),t=t.replace(/\D/g,"").slice(0,4),w(t,e)})},T=function(t){var e;return!(!t.metaKey&&!t.ctrlKey)||32!==t.which&&(0===t.which||(t.which<33||(e=String.fromCharCode(t.which),!!/[\d\s]/.test(e))))},E=function(e){var n,r,a,i;return a=e.currentTarget||e.target,r=String.fromCharCode(e.which),!/^\d+$/.test(r)||(!!o(a)||(i=(a.value+r).replace(/\D/g,""),n=t(i),n?i.length<=n.length[n.length.length-1]:i.length<=16))},C=function(t){var e,n,r;return n=t.currentTarget||t.target,e=String.fromCharCode(t.which),!/^\d+$/.test(e)||(!!o(n)||(r=n.value+e,r=r.replace(/\D/g,""),!(r.length>6)))},L=function(t){var e,n,r;return n=t.currentTarget||t.target,e=String.fromCharCode(t.which),!/^\d+$/.test(e)||(!!o(n)||(r=n.value+e,r.length<=4))},D=function(t){var e,r,a,i,u,s,l,c,o;if(l=t.currentTarget||t.target,o=l.value,a=g.cardType(o)||"unknown",!l.classList.contains(a)){for(e=function(){var t,e,a;for(a=[],t=0,e=n.length;t<e;t++)r=n[t],a.push(r.type);return a}(),l.classList.remove("unknown"),u=0,s=e.length;u<s;u++)c=e[u],l.classList.remove(c);return l.classList.add(a),l.classList.toggle("identified","unknown"!==a),i=new CustomEvent("payment.cardType",{detail:{cardType:a}}),l.dispatchEvent(i),l}},g.fn.formatCardCVC=function(){return g("restrictNumeric",this),d(this,"keypress",L),this.addEventListener("paste",v,!1),this.addEventListener("change",v,!1),this.addEventListener("input",v,!1),this},g.fn.formatCardExpiry=function(){return g("restrictNumeric",this),d(this,"keypress",C),this.addEventListener("keypress",s,!1),this.addEventListener("keypress",c,!1),this.addEventListener("keypress",l,!1),this.addEventListener("keydown",i,!1),this.addEventListener("change",p,!1),this.addEventListener("input",p,!1),this},g.fn.formatCardNumber=function(){return g("restrictNumeric",this),d(this,"keypress",E),this.addEventListener("keypress",u,!1),this.addEventListener("keydown",a,!1),this.addEventListener("keyup",D,!1),this.addEventListener("paste",f,!1),this.addEventListener("change",f,!1),this.addEventListener("input",f,!1),this.addEventListener("input",D,!1),this},g.fn.restrictNumeric=function(){return d(this,"keypress",T),this.addEventListener("paste",m,!1),this.addEventListener("change",m,!1),this.addEventListener("input",m,!1),this},g.fn.cardExpiryVal=function(){return g.cardExpiryVal(this.value)},g.cardExpiryVal=function(t){var e,n,r,a;return r=t.split(/[\s\/]+/,2),e=r[0],a=r[1],2===(null!=a?a.length:void 0)&&/^\d+$/.test(a)&&(n=(new Date).getFullYear(),n=n.toString().slice(0,2),a=n+a),e=parseInt(e,10),a=parseInt(a,10),{month:e,year:a}},g.validateCardNumber=function(e){var n,r;return e=(e+"").replace(/\s+|-/g,""),!!/^\d+$/.test(e)&&(n=t(e),!!n&&(r=e.length,k.call(n.length,r)>=0&&(n.luhn===!1||h(e))))},g.validateCardExpiry=function(t,e){var n,r,a;return"object"==typeof t&&"month"in t&&(a=t,t=a.month,e=a.year),!(!t||!e)&&(t=S(t),e=S(e),!!/^\d+$/.test(t)&&(!!/^\d+$/.test(e)&&(1<=t&&t<=12&&(2===e.length&&(e=e<70?"20"+e:"19"+e),4===e.length&&(r=new Date(e,t),n=new Date,r.setMonth(r.getMonth()-1),r.setMonth(r.getMonth()+1,1),r>n)))))},g.validateCardCVC=function(t,n){var r,a;return t=S(t),!!/^\d+$/.test(t)&&(r=e(n),null!=r?(a=t.length,k.call(r.cvcLength,a)>=0):t.length>=3&&t.length<=4)},g.cardType=function(e){var n;return e?(null!=(n=t(e))?n.type:void 0)||null:null},g.formatCardNumber=function(e){var n,r,a,i;return e=e.replace(/\D/g,""),(n=t(e))?(i=n.length[n.length.length-1],e=e.slice(0,i),n.format.global?null!=(a=e.match(n.format))?a.join(" "):void 0:(r=n.format.exec(e),null!=r?(r.shift(),r=r.filter(Number),r.join(" ")):void 0)):e},g.formatExpiry=function(t){var e,n,r,a;return(n=t.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(e=n[1]||"",r=n[2]||"",a=n[3]||"",a.length>0?r=" / ":" /"===r?(e=e.substring(0,1),r=""):2===e.length||r.length>0?r=" / ":1===e.length&&"0"!==e&&"1"!==e&&(e="0"+e,r=" / "),e+r+a):""},window.payment=g}).call(this);